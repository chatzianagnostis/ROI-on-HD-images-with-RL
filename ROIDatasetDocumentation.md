# Τεκμηρίωση της κλάσης ROIDataset

## Εισαγωγή

Η κλάση `ROIDataset` είναι ένα εργαλείο που διευκολύνει τη φόρτωση και επεξεργασία δεδομένων για εργασίες ανίχνευσης περιοχών ενδιαφέροντος (Region of Interest - ROI). Η κλάση αυτή χειρίζεται τόσο τις εικόνες όσο και τις αντίστοιχες επισημάνσεις (annotations) τους, επιτρέποντας την εύκολη προετοιμασία δεδομένων για εκπαίδευση και αξιολόγηση μοντέλων ανίχνευσης αντικειμένων.

## Λειτουργίες

Η κλάση `ROIDataset` παρέχει τις εξής βασικές λειτουργίες:

- Φόρτωση εικόνων και των αντίστοιχων επισημάνσεων από ένα φάκελο δεδομένων
- Υποστήριξη διαφορετικών μορφών επισημάνσεων (YOLO, COCO)
- Αυτόματη αναπροσαρμογή μεγέθους εικόνων και επισημάνσεων
- Δυνατότητα επανάληψης (iteration) μέσω του συνόλου δεδομένων
- Δημιουργία ομάδων (batches) δεδομένων για εκπαίδευση

## Εξαρτήσεις

Η κλάση χρησιμοποιεί τις ακόλουθες βιβλιοθήκες:

```python
import os
import cv2
import numpy as np
import json
from pathlib import Path
import random
from typing import Dict, List, Tuple, Optional, Generator, Any
```

## Αρχικοποίηση

```python
def __init__(
    self, 
    dataset_path: str, 
    image_size: Tuple[int, int] = (640, 640),
    annotations_format: str = "yolo",
    shuffle: bool = True,
    include_original: bool = True
):
```

### Παράμετροι

| Παράμετρος | Τύπος | Προεπιλογή | Περιγραφή |
|------------|-------|------------|-----------|
| `dataset_path` | `str` | - | Διαδρομή προς το φάκελο του συνόλου δεδομένων |
| `image_size` | `Tuple[int, int]` | `(640, 640)` | Μέγεθος στο οποίο θα αναπροσαρμοστούν οι εικόνες (πλάτος, ύψος) |
| `annotations_format` | `str` | `"yolo"` | Μορφή των επισημάνσεων ('yolo', 'coco', κλπ.) |
| `shuffle` | `bool` | `True` | Εάν θα γίνεται ανακάτεμα του συνόλου δεδομένων |
| `include_original` | `bool` | `True` | Εάν θα διατηρούνται οι αρχικές εικόνες στη μνήμη |

## Κύριες Μέθοδοι

### `_find_samples()`

```python
def _find_samples(self) -> List[Dict[str, Any]]:
```

Εντοπίζει όλα τα έγκυρα ζεύγη εικόνων-επισημάνσεων στο φάκελο του συνόλου δεδομένων.

**Επιστρέφει:**
- Μια λίστα λεξικών με κλειδιά `'image_path'` και `'annotation_path'` που αντιπροσωπεύουν τις διαδρομές των εικόνων και των αντίστοιχων επισημάνσεών τους.

### `__len__()`

```python
def __len__(self) -> int:
```

Επιστρέφει τον αριθμό των δειγμάτων στο σύνολο δεδομένων.

### `__iter__()`

```python
def __iter__(self) -> 'ROIDataset':
```

Κάνει το σύνολο δεδομένων επαναλήψιμο (iterable). Επαναφέρει το τρέχον ευρετήριο και προαιρετικά ανακατεύει τα δείγματα.

### `__next__()`

```python
def __next__(self) -> Dict[str, Any]:
```

Επιστρέφει το επόμενο δείγμα κατά την επανάληψη. Εγείρει εξαίρεση `StopIteration` όταν όλα τα δείγματα έχουν διατρέξει.

### `get_item()`

```python
def get_item(self, idx: int) -> Dict[str, Any]:
```

Επιστρέφει ένα συγκεκριμένο δείγμα με βάση το δείκτη.

**Παράμετροι:**
- `idx`: Ο δείκτης του δείγματος που θα επιστραφεί

**Επιστρέφει:**
Ένα λεξικό με τα ακόλουθα κλειδιά:
- `'image_id'`: Το όνομα αρχείου της εικόνας
- `'resized_image'`: Η αναπροσαρμοσμένη εικόνα
- `'annotations'`: Οι επισημάνσεις
- `'scale_factors'`: Συντελεστές κλίμακας για την αναπροσαρμογή (πλάτος, ύψος)
- `'original_size'`: Αρχικό μέγεθος της εικόνας (πλάτος, ύψος)
- `'original_image'`: Η αρχική εικόνα (προαιρετικά)

### `_load_annotations()`

```python
def _load_annotations(
    self, 
    annotation_path: str, 
    original_width: int, 
    original_height: int,
    width_scale: float,
    height_scale: float
) -> List[Dict[str, Any]]:
```

Φορτώνει επισημάνσεις με βάση τη μορφή και τις μετατρέπει σε τυποποιημένη μορφή.

**Παράμετροι:**
- `annotation_path`: Η διαδρομή του αρχείου επισημάνσεων
- `original_width`: Το αρχικό πλάτος της εικόνας
- `original_height`: Το αρχικό ύψος της εικόνας
- `width_scale`: Συντελεστής κλίμακας για το πλάτος
- `height_scale`: Συντελεστής κλίμακας για το ύψος

**Επιστρέφει:**
Μια λίστα λεξικών με τις επισημάνσεις, κάθε ένα από τα οποία περιέχει:
- `'category_id'`: Η κατηγορία του αντικειμένου
- `'bbox_orig'`: Το οριοθετικό πλαίσιο (bounding box) στην αρχική εικόνα [x, y, πλάτος, ύψος]
- `'bbox'`: Το οριοθετικό πλαίσιο στην αναπροσαρμοσμένη εικόνα
- `'score'`: Βαθμολογία (για προβλέψεις, προαιρετικά)

### `get_batch()`

```python
def get_batch(self, batch_size: int) -> List[Dict[str, Any]]:
```

Επιστρέφει μια ομάδα δειγμάτων.

**Παράμετροι:**
- `batch_size`: Το μέγεθος της ομάδας

**Επιστρέφει:**
Μια λίστα δειγμάτων, κάθε ένα με την ίδια δομή που επιστρέφεται από τη μέθοδο `get_item()`.

## Υποστηριζόμενες Μορφές Επισημάνσεων

### YOLO

Η μορφή YOLO χρησιμοποιεί αρχεία .txt με κάθε γραμμή να περιέχει:
```
class_id x_center y_center width height
```
Όπου όλες οι τιμές είναι κανονικοποιημένες [0-1] και κεντραρισμένες.

### COCO

Η μορφή COCO χρησιμοποιεί αρχεία JSON με οριοθετικά πλαίσια (bounding boxes) σε μορφή:
```
[x, y, width, height]
```
Όπου οι τιμές είναι σε απόλυτα pixel.

## Παράδειγμα Χρήσης

```python
# Δημιουργία συνόλου δεδομένων
dataset = ROIDataset(
    dataset_path="/path/to/dataset",
    image_size=(640, 480),
    annotations_format="yolo",
    shuffle=True
)

# Επανάληψη του συνόλου δεδομένων
for sample in dataset:
    image = sample['resized_image']
    annotations = sample['annotations']
    
    # Επεξεργασία εικόνας και επισημάνσεων...

# Λήψη μιας ομάδας δειγμάτων
batch = dataset.get_batch(batch_size=4)
```

## Περιορισμοί και Σημειώσεις

- Η κλάση αναμένει συγκεκριμένες μορφές δεδομένων και ενδέχεται να χρειαστεί προσαρμογή για άλλες μορφές.
- Οι επισημάνσεις μετατρέπονται σε τυποποιημένη μορφή [x, y, πλάτος, ύψος] ανεξάρτητα από την αρχική μορφή.
- Η κλάση δεν κάνει επαλήθευση των επισημάνσεων για να βεβαιωθεί ότι είναι έγκυρες.
- Εάν ένα αρχείο εικόνας δεν μπορεί να φορτωθεί, θα παραχθεί εξαίρεση.
